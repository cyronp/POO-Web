<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="static/create_movie.css" />
    <title>UnivilleDb - Cadastrar</title>
  </head>
  <body>
    <div class="header">
      <div class="icon">
        <h1 class="title">UnivilleDb</h1>
      </div>
      <div class="header-nav">
        <a class="sub-title" href="/movies_all">Ver todos</a>
        <a class="sub-title">Listar Filmes</a>
        <a class="sub-title">Listar Series</a>
        <a class="sub-title">Serie com maior nota</a>
        <a class="sub-title">Filme com maior nota</a>
        <a class="sub-title" href="/delete_movie"
          >Deletar Filme/Serie</a
        >
        <a class="sub-title" href="/edit_movie"
          >Editar Filme/Serie</a
        >
        <a class="sub-title" href="/create_movie"
          >Criar Filme/Serie</a
        >
      </div>
    </div>
    <div class="main-content">
      <div class="content">
        <h2 class="content-title">Cadastrar Filme/Série</h2>
        <p class="content-subtitle">
          Preencha os campos abaixo para adicionar um novo conteúdo
        </p>
        <div class="form-container">
          <form class="movie-form" id="movieForm">
            <div class="form-section">
              <h3 class="section-title">Informações Básicas</h3>

              <div class="form-group">
                <label for="contentType">Tipo de Conteúdo*</label>
                <select id="contentType" name="contentType" required>
                  <option value="">Selecione...</option>
                  <option value="movie">Filme</option>
                  <option value="series">Série</option>
                </select>
              </div>

              <div class="form-group">
                <label for="title">Título*</label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  placeholder="Ex: The Boys"
                  required
                />
              </div>

              <div class="form-group">
                <label for="imageUrl">URL da Imagem*</label>
                <input
                  type="url"
                  id="imageUrl"
                  name="imageUrl"
                  placeholder="https://exemplo.com/imagem.jpg"
                  required
                />
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="rating">Avaliação (0-10)*</label>
                  <input
                    type="number"
                    id="rating"
                    name="rating"
                    min="0"
                    max="10"
                    step="0.1"
                    placeholder="8.6"
                    required
                  />
                </div>

                <div class="form-group">
                  <label for="duration">Duração/Episódios*</label>
                  <input
                    type="text"
                    id="duration"
                    name="duration"
                    placeholder="Ex: 40 Episodios ou 120 min"
                    required
                  />
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3 class="section-title">Equipe</h3>

              <div class="form-group">
                <label for="director">Diretor/Criador*</label>
                <input
                  type="text"
                  id="director"
                  name="director"
                  placeholder="Ex: Eric Kripke"
                  required
                />
              </div>
            </div>

            <div class="form-section">
              <h3 class="section-title">Categorias</h3>

              <div class="form-row">
                <div class="form-group">
                  <label for="genre">Gênero Principal*</label>
                  <input
                    type="text"
                    id="genre"
                    name="genre"
                    placeholder="Ex: Comédia"
                    required
                  />
                </div>

                <div class="form-group">
                  <label for="subGenre">Gênero Secundário</label>
                  <input
                    type="text"
                    id="subGenre"
                    name="subGenre"
                    placeholder="Ex: Heróis"
                  />
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-cancel" onclick="history.back()">
                Cancelar
              </button>
              <button type="submit" class="btn-submit">
                Cadastrar Conteúdo
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
        document
            .getElementById("movieForm")
            .addEventListener("submit", function (e) {
                e.preventDefault();

                const formData = {
                    titulo: document.getElementById("title").value,
                    nota: parseFloat(document.getElementById("rating").value),
                    tipo: document.getElementById("contentType").value === "movie" ? "Filme" : "Serie",
                  duracao: document.getElementById("duration").value,
                    criador: document.getElementById("director").value,
                    genero: document.getElementById("genre").value,
                    subGenero: document.getElementById("subGenre").value,
                    capaUrl: document.getElementById("imageUrl").value,
                };

                fetch("/api/midias", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(formData),
                })
                    .then(response => {
                        if (!response.ok) {
                            return response.text().then(text => {
                                throw new Error(text || "Erro desconhecido ao cadastrar.");
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        alert("Conteúdo cadastrado com sucesso! ID: " + data.id);
                        window.location.href = "/movies_all";
                    })
                    .catch(error => {
                        console.error("Erro ao cadastrar:", error);
                        alert("Erro: " + error.message);
                    });
            });
    </script>
  </body>
</html>
